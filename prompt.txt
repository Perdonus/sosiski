Это мои 2 прошлых промпта и в конце новый. Проверь чтобы они были все выполнены и если чего то не хватает, довыполни это.

Сейчас бот в очень плачевном состоянии, у него ужасная стабильность (log.txt), постоянно лагает звёздный баланс и вип, в целом бот лагает и в целом интрф нон френдли.

1. Самое главное - полностью переписываем бота под масштабирование, большую гибкость, мобильность и самую лучшую стабильность.
Бот могу одновременно тыкать под сотню человек и крутить казик (что ваще самое сложное из всего) и бот должен стабильно обрабатывать всё это.
Спецификации устройства под которое будет идти разработка - Intel xeon e5, 1гб опры.
Этого должно с головой хватить под бота


про саму переработку


Переход на webhook

Polling подходит для разработки, но под нагрузкой вызывает 409 при multiprocessing и тратит ресурсы на пустые запросы. Webhook позволяют Telegram слать обновления на ваш сервер (Flask/ASGI), масштабируется горизонтально через Docker/HAProxy/K8s и снижает задержки.

​
Rate limiting и retry

Внедрите exponential backoff для 429: при ошибке ждите retry_after секунд, используйте Redis для глобального/чатового лимитера (библиотека aiolimiter или limited_aiogram_bot). Очереди (Celery + Redis/RabbitMQ) для фоновых задач разгружают API.

​
Асинхронность и состояние

Aiogram (v3) с FSM (Finite State Machine) хранит состояние пользователей в Redis/PostgreSQL для stateless-архитектуры. Избегайте threading/multiprocessing в polling — один Dispatcher на инстанс.
​
Масштабирование

Разверните несколько инстансов бота за load balancer (HAProxy), используйте Docker Compose для горизонтального scaling. Мониторьте с Prometheus, база — Redis/PostgreSQL для сессий.


Если ты сможешь сделать сам что то, того что не указано тут и это будет полезно - делай.
Если что то нужно будет установить или скачать - пиши, по возможности делай сам.



2. Переработка Функционала и Меню бота, и их доработка

1) Если чувак пытается сделать трейд, но у него нету диалога в лс с ботом или он заблокирован. Надо предупредить его об этом.
Отправь сообщение, типа для использования надо активировать бота в лс и кидай ему ссылку на бота типа /start но чтобы в лс уже.
юз у бота ес че @sosiskikazikbot

2) Вип. 
	1) Урезать шансы для Випов в крутках и казике, а то слишком жёстко. То бишь, шансы которые сейчас для обычных игроков, мы ставим для випов, а шансы для обычных мы урезаем. казик и крутки.
	2) В вип мы не пишем прям точно, просто примерно типа Повышенный шанс выпадения и не пишем насколько, просто повышен и тд.
	3) Убрать возможность купить Звёздную крутку за 5 звёзд, онли Випкам и в целом урезать шансы Звёздной редкости и сделать её раз в 24 часа.
	4) Убрать 1 рандомную эксклюзивную сосиску, 5р за казик в Випке
	5) цена випки 50 звёзд

3) Сделай возможность отправлять сообщения всем юзерам в лс через бота
Это буду делать я, а тоесть 6603471853 буду через /text отправлять сообщения всем в лс

4) Переработке редкостей
	1) Сделай мемную редкость. Она будет по шансам как Платина.
	2) Переработаем редкость Exclusive. Сосиски этой редкости могут быть анимированными. Это будут форматы типа .gif, .webm ну и тд.

5) Новое меню кнопок и меню (Схема)
Крутка
	Обычная
	Премиум (ранее звёздная)
	Подарок
	Казик
Сосиски
	Мои
	Купить
	Трейд
VIP
Топ


6) Убираем из меню Скидки, Звёзды и Розыгрыши.
Скидки перерабатываем, Звёзды рудимент (при оплате Випа просто сразу открываешь меню с оплатой, а больше ничего донатного), Розыгрыши онли для лс

Про скидки и меню в целом
Перерабатываем паттерн из Магазина, Инвенторя, Трейдов и тд

(редкость) Название - Цена

пример
(Дно) Сосиска - 76р

при скидке
(Дно) Сосиска - 50р 76р (вторую цену с зачеркиванием и крусивом от тг, это старая цена)

При продаже делай подтверждение
и также как при скидке пиши, но без курсива
(Дно) Сосиска - 40р 76р

7) Сделай в углу всех меню небольшой, но заметный значок. Просто белый значок без фона. Твоя задача сделать так, чтобы он подстраивался под все фона, под чёрные, под белые, под разноцветные и всякие странные переливы. Штобы он подстраивал свой цвет и был всегда видным.
Это будет logo.png (или любой другой формат) И тебе надо кстати на видео сосисках Exclusive также делать это лого.

8) Переработать некоторые меню, поместил фото в папку logs.
Как то сместить текст с фото профиля
убрать с фотки Крутим... в казике размытые цифры, они там не нужны, просто по центру надпись Крутим...

9) Добавь к названиям редкостей Эмодзи. Кинул также пример из другого бота.





короче вот сумбурно напиханные идеи, которые ты попробуй реализовать.

ЧерныйЛавилас13ム❅, [11.01.2026 5:43]
Сделать в казике фри спины
Для фри юзеров 1 спин раз в 24 часа
Для ВИП 10 спинов раз в 24 часа

Убрать звёздную крутку 

Вернём всё же Звёзды, тк я забыл о сущестовании Exclusive
Но переработаем Сделай меню Донат на месте кнопки VIP и туда перемести VIP  и добавь Звёзды. При нажатии напишет сколько их щас в сообщении и будет кнопка назад и пополнить. При пополнении ты напишешь (Введи кол-во звёзд (минимум 25)) и ты парсишь число юзера и делаешь оплату. 

В VIP сделай при оплате не просто сообщение с пополнением в звёздах а доп меню с кнопкой Оплатить с баланса или Звёздами.

Эксклюзивные сосиски ограничены по тиражу
каждую можно будет купить только 1 раз и всё


Добавь во все новые доп меню кнопку Назад, чтобы вернутсья в профиль и всё
В старых замени Главное меню тоже на Назад

ЧерныйЛавилас13ム❅, [11.01.2026 5:53]
Надо поработать с текстом
И где можно его добавить, добавить

Ну типа можно в меню Крутки написать там
Сколько осталось до след крутки
И сколько осталось фри спинов и времени до сброса

ЧерныйЛавилас13ム❅, [11.01.2026 5:53]
А в донате пишет сколько осталось до конца подписки, випка покупается на две недели.

ЧерныйЛавилас13ム❅, [11.01.2026 5:53]
Просто типа Добрый день!, Доброй ночи ну и тд в зависимости от времени суток

ЧерныйЛавилас13ム❅, [11.01.2026 5:53]
И юз

ЧерныйЛавилас13ム❅, [11.01.2026 5:57]
Сделай систему рефералов с бонусами, по ссылке
чтобы по твоей рефке кто-то переходил и ты и он получали фри спин в казике

ЧерныйЛавилас13ム❅, [11.01.2026 6:16]
сделай чтобы раз в пару дней в чат (лс) писало соо типа Добавьте бота свой чат! и кнопка добавить в чат
которая откроет меню с добавлением бота в чат





Казик нельзя купить
В логс закинул примеры вида меню выбора сосисок и меню с самимим сосисками
и нынешние профили, которые выглядят странно